/*!
 * fitapp v0.0.1 (https://github.com/mediaroth/fitapp)
 * Copyright 2011-2014 mediaroth
 * Licensed under BSD
 */
angular.module("fitApp.directives",[]),angular.module("fitApp.services",[]),angular.module("fitApp.filters",[]),angular.module("fitApp.controllers",["fitApp.services"]);var fitApp=angular.module("fitApp",["ngRoute","ngAnimate","ngCookies","ui.bootstrap","restangular","fitApp.services","fitApp.controllers","fitApp.filters","fitApp.directives"]).constant("ACCESS_LEVELS",{pub:0,user:1}).config(["$routeProvider","$locationProvider","ACCESS_LEVELS",function(a,b,c){b.html5Mode(!0),a.when("/",{templateUrl:"/templates/home.html",controller:"HomeController",resolve:{redirectTo:function(a,b,d){var e=a.defer();return d.checkUser(c.user).then(function(a){a.data.error?(console.log("in app - not authorized"),b.path("/login"),e.resolve("yo")):(console.log("in app - authorized"),e.resolve("yo"))},function(){console.log("in app - route /resolve - error"),e.reject("/login")}),e.promise}}}).when("/table",{templateUrl:"/templates/table.html"}).when("/workout/option1",{templateUrl:"/templates/table.html"}).when("/workout/option2",{templateUrl:"/templates/table.html"}).when("/exercise",{templateUrl:"/templates/exercise.html",controller:"ExerciseController",resolve:{user:function(a,b,d){var e=a.defer();return d.checkUser(c.user).then(function(a){console.log(a),a?(console.log("in app - authorized"),e.resolve()):(console.log("in app - not authorized"),b.path("/login"),e.reject())},function(){b.path("/login"),e.reject()}),e.promise}},access_level:c.user}).when("/workout",{templateUrl:"/templates/workout.html",controller:"WorkoutController",resolve:{user:function(a,b,d){var e=a.defer();return d.checkUser(c.user).then(function(a){console.log(a),a?(console.log("in app - authorized"),e.resolve()):(console.log("in app - not authorized"),b.path("/login"),e.reject())},function(){b.path("/login"),e.reject()}),e.promise}},access_level:c.user}).when("/register",{templateUrl:"/templates/register.html",controller:"UserController",access_level:c.pub}).when("/logout",{resolve:{user:function(a,b,c){var d=a.defer();return c.logout().then(function(){b.path("/login"),d.resolve()},function(){console.log("could not logout user !"),d.reject()}),d.promise}}}).when("/myprofile",{templateUrl:"/templates/myprofile.html",controller:"UserController",access_level:c.user}).when("/login",{templateUrl:"/templates/login.html",controller:"UserController",access_level:c.pub}).otherwise({redirectTo:"/",templateUrl:"/templates/home.html",resolve:{user:function(a,b,d){var e=a.defer();d.checkUser(c.user).then(function(a){return console.log(a),a?(console.log("in app - authorized"),e.resolve()):(console.log("in app - not authorized"),b.path("/login"),e.reject()),e.promise},function(){return console.log("in app - route resolve - error"),b.path("/login"),e.reject(),e.promise})}}})}]).factory("authInterceptor",function(a,b,c){return{request:function(a){return a.headers=a.headers||{},c.sessionStorage.token&&(a.headers["X-AUTH-TOKEN"]=c.sessionStorage.token),a},response:function(a){return a||b.when(a)}}}).config(["$httpProvider",function(a){a.interceptors.push("authInterceptor")}]).run(function(a,b){a.$on("$routeChangeStart",function(b,c){c.$$route&&c.$$route.resolve&&(a.loadingView=!0)}),a.$on("$routeChangeSuccess",function(){a.loadingView=!1}),a.isSpecificPage=function(){var a;return a=b.path(),_.contains(["/404","/500","/login","/register"],a)}});angular.module("fitApp.controllers").controller("ExerciseController",["$scope","exerciseService","$location","$filter",function(a,b,c,d){return a.model={},a.model.loading=!1,a.model.form={},a.model.form.submitted=!1,a.model.form.errors=[],a.model.form.success=!1,a.model.record={},a.model.list=[],a.model.table={},a.model.table.maxNumPerPage=[3,5,10,20],a.model.table.currentSortedField="",a.model.table.searchKeyword="",a.model.table.currentPage=1,a.model.table.currentPageData=[],a.model.table.totalPageData=[],a.submit=function(){a.model.form.error=!1,a.model.form.success=!1,a.model.form.$valid?(a.model.form.submitted=!1,a.model.form.error=!1,a.model.form.loading=!0,_.isUndefined(a.model.record.id)?b.post(a.model.record).then(function(c){return a.model.form.success=c.success,console.log(a.model.form.success),b.getAll()},function(c){return a.model.form.error=c.data.error,a.model.form.errors=c.data.errors,b.getAll()}).finally(function(){}).then(function(b){a.model.list=b,a.model.loading=!1,a.model.table.onUpdate()},function(a){console.log(a)}):b.put(a.model.record).then(function(c){return a.model.form.success=c.success,b.getAll()}).then(function(b){a.model.list=b,a.model.loading=!1,a.model.table.onUpdate()},function(a){console.log(a)})):a.model.form.submitted=!0},a.destroy=function(c){a.model.loading=!0,b.destroy(c).then(function(){return b.getAll()},function(a){console.log(a)}).then(function(b){console.log("updated list"),a.model.list=b,a.model.loading=!1,a.model.table.onUpdate()})},a.edit=function(c){a.model.form.error=!1,a.model.form.success=!1,b.get(c).then(function(b){a.model.record=b,console.log(a.model.record)})},a.clear=function(){a.model.form.error=!1,a.model.form.success=!1,a.model.form.submitted=!1,a.model.form.$setPristine(),a.model.record={}},a.model.table.search=function(){a.model.table.currentPageData=a.model.table.totalPageData=d("filter")(a.model.list,a.model.table.searchKeyword)},a.model.table.select=function(){var b,c;c=(a.model.table.currentPage-1)*a.model.table.numPerPage,b=c+a.model.table.numPerPage,a.model.table.search(),a.model.table.sort(a.model.table.currentSortedField),a.model.table.slice(c,b)},a.model.table.sort=function(b){a.model.table.currentSortedField=b,a.model.table.currentPageData=d("orderBy")(a.model.table.currentPageData,b)},a.model.table.slice=function(b,c){a.model.table.currentPageData=a.model.table.currentPageData.slice(b,c)},init=function(){b.getAll().then(function(b){a.model.list=b,a.model.table.search(),a.model.table.currentSortedField="+id",a.model.table.sort(a.model.table.currentSortedField),a.model.table.numPerPage=a.model.table.maxNumPerPage[1],a.model.table.slice(0,a.model.table.numPerPage)})},a.model.table.onUpdate=function(){a.model.table.search(),a.model.table.sort(a.model.table.currentSortedField),a.model.table.slice(0,a.model.table.numPerPage),a.model.table.currentPage=1,console.log(a.model.table.totalPageData)},a.model.table.onSort=function(b){a.model.table.search(),a.model.table.sort(b),a.model.table.slice(0,a.model.table.numPerPage),a.model.table.currentPage=1},init()}]),angular.module("fitApp.controllers").controller("HomeController",function(a){a.test="Hello World, I'm so cool ! Maybe even more so !! Oh Yeaahhhh, so jelly right now"}),angular.module("fitApp.controllers").controller("TableController",["$rootScope","$scope","$filter",function(a,b,c){return b.table={},b.table.data=[{name:"Nijiya Market",price:"$$",sales:292,rating:4},{name:"Eat On Monday Truck",price:"$",sales:119,rating:4.3},{name:"Tea Era",price:"$",sales:874,rating:4},{name:"Rogers Deli",price:"$",sales:347,rating:4.2},{name:"MoBowl",price:"$$$",sales:24,rating:4.6},{name:"The Milk Pail Market",price:"$",sales:543,rating:4.5},{name:"Nob Hill Foods",price:"$$",sales:874,rating:4},{name:"Scratch",price:"$$$",sales:643,rating:3.6},{name:"Gochi Japanese Fusion Tapas",price:"$$$",sales:56,rating:4.1},{name:"Cost Plus World Market",price:"$$",sales:79,rating:4},{name:"Bumble Bee Health Foods",price:"$$",sales:43,rating:4.3},{name:"Costco",price:"$$",sales:219,rating:3.6},{name:"Red Rock Coffee Co",price:"$",sales:765,rating:4.1},{name:"99 Ranch Market",price:"$",sales:181,rating:3.4},{name:"Mi Pueblo Food Center",price:"$",sales:78,rating:4},{name:"Cucina Vention",price:"$$",sales:163,rating:3.3},{name:"Sufi Coffee Shop",price:"$",sales:113,rating:3.3},{name:"Dana Street Roasting",price:"$",sales:316,rating:4.1},{name:"Pearl Cafe",price:"$",sales:173,rating:3.4},{name:"Posh Bagel",price:"$",sales:140,rating:4},{name:"Artisan Wine Depot",price:"$$",sales:26,rating:4.1},{name:"Hong Kong Chinese Bakery",price:"$",sales:182,rating:3.4},{name:"Starbucks",price:"$$",sales:97,rating:3.7},{name:"Tapioca Express",price:"$",sales:301,rating:3},{name:"House of Bagels",price:"$",sales:82,rating:4.4}],b.table.maxNumPerPage=[3,5,10,20],b.table.currentSortedField="",b.table.searchKeyword="",b.table.currentPage=1,b.table.currentPageData=[],b.table.totalPageData=[],b.table.search=function(){b.table.currentPageData=b.table.totalPageData=c("filter")(b.table.data,b.table.searchKeyword)},b.table.select=function(){var a,c;c=(b.table.currentPage-1)*b.table.numPerPage,a=c+b.table.numPerPage,b.table.search(),b.table.sort(b.table.currentSortedField),b.table.slice(c,a)},b.table.sort=function(a){b.table.currentSortedField=a,b.table.currentPageData=c("orderBy")(b.table.currentPageData,a)},b.table.slice=function(a,c){b.table.currentPageData=b.table.currentPageData.slice(a,c)},init=function(){b.table.search(),b.table.currentSortedField="+name",b.table.sort(b.table.currentSortedField),b.table.numPerPage=b.table.maxNumPerPage[1],b.table.slice(0,b.table.numPerPage)},b.table.onUpdate=function(){b.table.search(),b.table.sort(b.table.currentSortedField),b.table.slice(0,b.table.numPerPage),b.table.currentPage=1,console.log(b.table.totalPageData)},b.table.onSort=function(a){b.table.search(),b.table.sort(a),b.table.slice(0,b.table.numPerPage),b.table.currentPage=1},init()}]),angular.module("fitApp.controllers").controller("UserController",["$scope","$location","userService","$http","$window",function(a,b,c,d,e){console.log(e.sessionStorage),a.user={},a.loading=!1,a.submitted=!1,a.errors=[],a.success=!1,a.register=function(){a.error=!1,a.success=!1,a.register_form.$valid?(a.submitted=!1,a.error=!1,a.loading=!0,c.post(a.user).then(function(c){a.success=c.success,b.path("/myprofile")},function(b){a.error=b.data.error,a.errors=b.data.errors})):a.submitted=!0},a.login=function(){a.error=!1,a.success=!1,a.login_form.$valid?(a.submitted=!1,a.error=!1,a.loading=!0,c.postAuth(a.user).then(function(){b.path("/myprofile")},function(b){a.error=!0,a.errors=[b.data.error.message]})):a.submitted=!0},a.clear=function(){a.error=!1,a.success=!1,a.submitted=!1,a.register_form.$setPristine()}}]),angular.module("fitApp.controllers").controller("WorkoutController",["$scope","$http","workoutService",function(a,b,c){a.workoutData={},a.workouts=[],a.loading=!1,a.submitted=!1,a.errors=[],a.success=!1,a.workouts=c.getAll().$object,a.submit=function(){a.error=!1,a.success=!1,a.workout_form.$valid?(a.submitted=!1,a.error=!1,a.loading=!0,a.workoutData.id?c.put(a.workoutData).then(function(b){return a.success=b.success,c.getAll()}).then(function(b){a.workouts=b,a.loading=!1},function(a){console.log(a)}):c.post(a.workoutData).then(function(b){return console.log(b),a.success=b.success,c.getAll()},function(b){return a.error=b.data.error,a.errors=b.data.errors,c.getAll()}).finally(function(){}).then(function(b){a.workouts=b,a.loading=!1},function(a){console.log(a)})):a.submitted=!0},a.destroy=function(b){a.loading=!0,c.destroy(b).then(function(){return console.log("deleted "+b),c.getAll()},function(a){console.log(a)}).then(function(b){console.log("updated list"),a.workouts=b,a.loading=!1})},a.edit=function(b){a.error=!1,a.success=!1,c.get(b).then(function(b){a.workoutData=b})},a.clear=function(){a.workoutData={},a.error=!1,a.success=!1,a.submitted=!1,a.workout_form.$setPristine()}}]),angular.module("fitApp.directives",[]).directive("mrSetFocus",function(){return{restrict:"A",controller:["$scope","$element","$attrs","$location",function(a,b,c,d){var e;return e=b.find("a"),currentPath=function(){return d.path()},setFocus=function(a){e.each(function(){var b=$(this),c=b.attr("href");c===a?b.parent("li").addClass("active"):b.parent("li").removeClass("active")})},setFocus(currentPath()),a.$watch(currentPath,function(a,b){a!==b&&setFocus(a)})}]}}).directive("tableList",function(){return{restrict:"A",replace:!0,templateUrl:"/templates/directives/tableList.html",scope:{objects:"=objects",edit:"=editFn",destroy:"=destroyFn",someProp:"@"},controller:function(){}}}).directive("ngFocus",[function(){var a="ng-focused";return{restrict:"A",require:"ngModel",link:function(b,c,d,e){e.$focused=!1,c.bind("focus",function(){c.addClass(a),b.$apply(function(){e.$focused=!0})}).bind("blur",function(){c.removeClass(a),b.$apply(function(){e.$focused=!1})})}}}]).directive("mrToggleMinNav",["$rootScope",function(a){return{restrict:"A",link:function(b,c){var d;d=$("#app"),c.on("click",function(b){return d.hasClass("nav-min")?d.removeClass("nav-min"):(d.addClass("nav-min"),a.$broadcast("minNav:enabled")),b.preventDefault()})}}}]).directive("mrCollapseNav",[function(){return{restrict:"A",link:function(a,b){var c,d,e,f,g,h;return h=200,e=b.find("ul").parent("li"),e.append('<i class="fa fa-caret-right icon-has-ul"></i>'),c=e.children("a"),f=b.children("li").not(e),d=f.children("a"),g=$("#app"),c.on("click",function(a){var b,c;return g.hasClass("nav-min")?!1:(b=$(this),c=b.parent("li"),e.not(c).removeClass("open").find("ul").slideUp(h),c.toggleClass("open").find("ul").slideToggle(h),a.preventDefault())}),d.on("click",function(){return e.removeClass("open").find("ul").slideUp(h)}),a.$on("minNav:enabled",function(){return e.removeClass("open").find("ul").slideUp()})}}}]).directive("mrCustomBackground",function(){return{restrict:"A",controller:["$scope","$element","$location",function(a,b,c){var d,e;return e=function(){return c.path()},d=function(a){switch(b.removeClass("body-home body-special body-tasks body-lock"),a){case"/":return b.addClass("body-home");case"/404":case"/pages/500":case"/login":case"/register":return b.addClass("body-special");case"/pages/lock-screen":return b.addClass("body-special body-lock");case"/tasks":return b.addClass("body-tasks")}},d(c.path()),a.$watch(e,function(a,b){return a!==b?d(c.path()):void 0})}]}}).directive("mrMsgBox",function(){return{restrict:"A",scope:{body:"@",title:"@",onConfirm:"&confirm"},link:function(a,b){b.on("click",function(){var b=$(".msg-box");$(".msg-box .title").html(a.title),$(".msg-box .body").html(a.body),$(".msg-box .cancel").unbind().on("click",function(){b.fadeOut(200)}),$(".msg-box .ok").unbind().on("click",function(){a.onConfirm(),b.fadeOut(200)}),b.fadeIn(200)})}}}),angular.module("fitApp.services").provider("auth",function(){var a={};this.setToken=function(b){console.log("in setToken"),a.token=b,console.log(a)},this.setUser=function(b){console.log("setUser"),a=b},this.$get=function(){return{isAuthorized:function(){return!1},getUser:function(){return console.log("in get user"),a},getToken:function(){return a}}}}),angular.module("fitApp.services").factory("exerciseService",function(a){var b=a.withConfig(function(a){a.setBaseUrl("/api")}),c=b.all("exercises");return{getAll:function(){return c.getList()},get:function(a){return b.one("exercises",a).get()},post:function(a){return c.post(a)},put:function(a){return a.put()},destroy:function(a){return b.one("exercises",a).remove()}}}),angular.module("fitApp.services").factory("userService",function(a,b,c,d,e,f){var g=f.withConfig(function(a){a.setBaseUrl("/api")}),h=g.all("users"),i={};return{getAll:function(){return h.getList()},get:function(a){return g.one("users",a).get()},getUser:function(){return i||(console.log("http"),e.get("/auth").success(function(a){return b.sessionStorage.token=a.token,console.log("http"),i=a.user,a.user}).error(function(){delete b.sessionStorage.token,console.log("error")})),i},checkUser:function(f){return e.get("/auth").success(function(b){b.error?d.reject(b):(i=b,a.authorized=!0,f<=i.role||d.reject(b))}).error(function(a){console.log("in checkUser error"),delete b.sessionStorage.token,c.path("/login"),d.reject(a)})},post:function(a){return h.post(a)},postLogin:function(a){return h.customPOST(a,"login")},postAuth:function(c){return e.post("/auth",c).success(function(c){return b.sessionStorage.token=c.token,a.authorized=!0,i=c.user,!0}).error(function(a){console.log(a),delete b.sessionStorage.token,d.reject()})},logout:function(){var c=d.defer();return delete b.sessionStorage.token,a.authorized=!1,i={},c.resolve(),c.promise},put:function(a){return a.put()},destroy:function(a){return g.one("users",a).remove()}}}),angular.module("fitApp.services").factory("workoutService",function(a){var b=a.withConfig(function(a){a.setBaseUrl("/api")}),c=b.all("workouts");return{getAll:function(){return c.getList()},get:function(a){return b.one("workouts",a).get()},post:function(a){return c.post(a)},put:function(a){return a.put()},destroy:function(a){return b.one("workouts",a).remove()}}});